<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> <mapper namespace="com.etop.website.dao.ServiceQuotationDao"> 	  <update id="changStatus" parameterType="com.etop.management.bean.Companyservice">			UPDATE etop_service			SET changes = #{changes}			WHERE				service_id = #{serviceId}   	  </update> 	  	<!-- 插入出账记录 -->	<insert id="add" parameterType="com.etop.management.entity.EtopBill">		INSERT INTO		etop_bill(bill_id,park_id,bill_type,bill_status,company_id,company_name,bill_source,bill_no_out,created_time,		deadline,pay_time,amount,amount_paid,overdue_fine,overdue_rate,account_remission,overdue_remission,		description,attachment,audit_status,audit_level,auditor,audit_time,finance,finance_time)		VALUES(#{billId},#{parkId},#{billType},#{billStatus},#{companyId},#{companyName},#{billSource},		#{billNoOut},#{createdTime},#{deadline},#{payTime},#{amount},#{amountPaid},#{overdueFine},#{overdueRate},		#{accountRemission},#{overdueRemission},#{description},#{attachment},#{auditStatus},#{auditLevel},		#{auditor},#{auditTime},#{finance},#{financeTime})	</insert>      <insert id="addQuotation"  parameterType="com.etop.website.bean.ServiceQuotation"  >		  INSERT INTO 		    etop_service_quotation (		         quotation_id,quotation_name,price,description,units		       )			VALUES( 				 #{quotationId},#{quotationName}, #{price},				 #{description},#{units}			   )      </insert>     <!-- 获得房间 -->     <select id="selectRoom" resultType="Map"  parameterType="Map"  >		SELECT			*		FROM			etop_floor_room		WHERE		  companyId=#{companyId}     </select>          <!-- 根据房间获得楼、层、区 -->      <select id="getPlace" resultType="com.etop.management.entity.EtopFloorRoom"  parameterType="Map"  >		SELECT			id,room_num,ref_area_id,ref_storey_id,ref_floor_id		FROM			etop_floor_room		WHERE		  companyId=#{companyId} 		AND          room_num=#{roomNum}     </select>             <select id="searchFloorId" resultType="String" parameterType="Map">				SELECT					build_name				FROM					etop_floor				WHERE					id = #{refFloorId}        </select>              <select id="searchStoreyId" resultType="String" parameterType="Map">				SELECT					build_name				FROM					etop_floor				WHERE					id = #{refStoreyId}        </select>                  <select id="searchAreaId" resultType="String" parameterType="Map">				SELECT					build_name				FROM					etop_floor				WHERE					id = #{refAreaId}				        </select>        <!-- 维修申请 -->      <insert id="addServiceBusiness"  parameterType="com.etop.website.bean.ServiceBusiness"  >		  INSERT INTO 		    etop_service_business (		         business_id,quotation_id,service_id,subject,number,unit,unit_price,total_price		       )			VALUES( 				 #{businessId},#{quotationId},#{serviceId}, #{subject},#{number},				 #{unit},#{unitPrice},#{totalPrice}			   )      </insert>                  <!-- 获取维修服务类型 -->     <select id="getCategoryList" resultType="com.etop.website.bean.ServiceQuotation"  parameterType="Map"  >		SELECT			category		FROM			etop_service_quotation		WHERE			type = #{type}		AND				park_id=#{parkId}		AND 		    activated = '1'		GROUP BY			category     </select>      <!-- 获取维修服务类型 -->     <select id="getQuotationList" resultType="com.etop.website.bean.ServiceQuotation"  parameterType="Map"  >		SELECT			*		FROM			etop_service_quotation        WHERE type='repair'         and activated ='1'        and park_id=#{parkId}		<if test="category != null and category != ''">       and  category like '%${category}%'        </if>		<if test="categories != null and categories != ''">       and  category = #{categories}        </if>     </select>                <!-- 获取商业服务类型 -->     <select id="getQuotationServiceList" resultType="com.etop.website.bean.ServiceQuotation"  parameterType="Map"  >	      SELECT			*		FROM			etop_service_quotation        WHERE type='service'         and activated ='1'        and park_id=#{parkId}        <if test="category != null and category != ''">       and  category like '%${category}%'        </if>        <if test="categories != null and categories != ''">       and  category = #{categories}        </if>     </select>          <select id="getQuotationRecruitmentList" resultType="com.etop.website.bean.ServiceQuotation"  parameterType="Map"  >	      SELECT			*		FROM			etop_service_quotation        WHERE type='person'         and activated ='1'        and park_id=#{parkId}         <if test="category != null and category != ''">       and  category like '%${category}%'        </if>        <if test="categories != null and categories != ''">       and  category = #{categories}        </if>     </select>               <select id="getQuotationServiceListtwo" resultType="Map"  parameterType="com.etop.website.bean.ServiceQuotation"  >	      SELECT			*			FROM			etop_service_type t1,			etop_service_quotation t2			WHERE			t1.service_name=t2.quotation_name			AND			t1.service_code=#{value} 			AND			t2.type='service'      </select>      <!-- 根据类别获得服务名称 -->      <select id="getCategory" resultType="Map"  parameterType="Map"  >		SELECT			*		FROM			etop_service_quotation		WHERE		  category=#{category}		AND				park_id=#{parkId}     </select>      <!-- 根据服务名获得具体信息 -->      <select id="getQuotation" resultType="Map"  parameterType="Map"  >		SELECT			*		FROM			etop_service_quotation		WHERE		  quotation_id=#{quotationId}     </select>         <!-- 查询维修表 -->           <select id="getServiceQuotation" resultType="com.etop.website.bean.ServiceQuotation" parameterType="Map">				SELECT					*				FROM				    etop_service_quotation				WHERE type='repair'    				<if test="parkId != null and parkId != ''">				AND				   park_id =#{parkId}				</if>				<if test="quotationId != null and quotationId != ''">				AND				   quotation_id = #{quotationId}				</if>				<if test="quotationName != null and quotationName != ''">				AND 				   quotation_name like '%${quotationName}%'				</if>				<if test="category != null and category != ''">				AND				   category like '%${category}%'				GROUP BY                    category				</if>        </select>                   <select id="getServiceQuotationGroup" resultType="com.etop.website.bean.ServiceQuotation" parameterType="Map">				SELECT					*				FROM				    etop_service_quotation				WHERE type='repair'    				<if test="parkId != null and parkId != ''">				AND				   park_id =#{parkId}				</if>				<if test="quotationId != null and quotationId != ''">				AND				   quotation_id = #{quotationId}				</if>				<if test="quotationName != null and quotationName != ''">				AND 				   quotation_name like '%${quotationName}%'				</if>				<if test="category != null and category != ''">				AND				   category like '%${category}%'				</if>				GROUP BY                    category        </select>        <!--     验证是否存在重复服务     -->       <select id="proveQuotationName" parameterType="Map" resultType="String">		       SELECT					count(*)				FROM					etop_service_quotation				WHERE					 quotation_name =#{quotationName}			    AND 			  		park_id =#{parkId}			  	AND					 type=#{type}				       </select>         <select id="getQuotationInfoById" resultType="com.etop.website.bean.ServiceQuotation" parameterType="Map">                SELECT					*				FROM				    etop_service_quotation				WHERE				   quotation_id = #{quotationId}        </select>                <update id="updateQuotation"  parameterType="com.etop.website.bean.ServiceQuotation">        update          				etop_service_quotation        set		<trim suffixOverrides=",">            <if test="category != null  ">                category=#{category},            </if>            <if test="quotationName != null  ">                quotation_name=#{quotationName},            </if>            <if test="price != null  ">                price=#{price},            </if>            <if test="description != null  ">                description=#{description},            </if>                        <if test="units != null  ">                units=#{units},            </if>            <if test="remark != null  ">                remark=#{remark},            </if>            <if test="activated != null  ">                activated=#{activated},            </if>        </trim>			WHERE		         quotation_id = #{quotationId}    </update>             <delete id="deleteQuotation" parameterType="string">		DELETE		FROM			etop_service_quotation		WHERE		   quotation_id = #{quotationId}	</delete>               <insert id="addQuotationService"  parameterType="com.etop.website.bean.ServiceQuotation"  >		  INSERT INTO 		    etop_service_quotation (		         quotation_id,category,quotation_name,price,units,description,remark,type,create_time,park_id,activated		       )			VALUES( 				 #{quotationId},#{category},#{quotationName}, #{price},				 #{units},#{description},#{remark},#{type},#{createTime},#{parkId},#{activated}			   )      </insert>            <select id="getQuotationBusiness" parameterType="com.etop.website.bean.Parkservice" resultType="com.etop.management.bean.Etopservice">			SELECT				*,category as categoryName			FROM				etop_service t1			INNER JOIN etop_service_business t2 ON t1.service_id = t2.service_id			INNER JOIN etop_service_quotation t3 ON t3.quotation_id = t2.quotation_id			WHERE			t1.service_type='WYBX'			and			 t1.club_id= #{clubId}			<if test="serviceNo != null and serviceNo != ''">			AND			   t1.service_no = #{serviceNo}			</if>			<if test="subject != null and subject != ''">			AND 			   t2.subject like '%${subject}%'			</if>			<if test="companyName != null and companyName != ''">			AND 			   t1.company_name like '%${companyName}%'			</if>			<if test="applyTime != null and applyTime != ''" >			AND				t1.apply_time >= #{applyTime}       		    </if> 		    <if test="completeTime != null and completeTime != ''" >			AND				 t1.complete_time &lt;= #{completeTime}       		    </if> 		    <if test="serviceStatus != null and serviceStatus != ''">			AND 			   t1.service_status = #{serviceStatus}			</if>		    <if test="categoryName != null and categoryName != ''">			AND 			   t3.category like '%${categoryName}%'			</if>      </select>             <select id="getQuotationBusinessInfoById" resultType="com.etop.management.bean.Etopservice" parameterType="Map">			SELECT				*			FROM				etop_service t1			INNER JOIN etop_service_business t2			ON				t1.service_id = t2.service_id			INNER JOIN etop_service_quotation t3 			ON 			    t2.quotation_id = t3.quotation_id			WHERE			   t1.service_id = #{service_id}        </select>       <!--派工信息  -->               <select id="getDispatchInfoById" resultType="com.etop.management.bean.ServiceDispatch" >			SELECT				*			FROM				 etop_service_dispatch 				WHERE				service_id = #{service_id}			ORDER BY despatch_time DESC			LIMIT 1        </select>     <update id="updateFinalPrice"  parameterType="com.etop.website.bean.ServiceBusiness">			UPDATE etop_service_business t1			INNER JOIN			   etop_service t2			ON t1.service_id=t2.service_id			SET							t1.final_price =#{finalPrice},					t2.service_status=#{serviceStatus}			WHERE					 t2.service_id = #{serviceId}    </update>    <update id="statusOfSend" parameterType="com.etop.website.bean.Parkservice">			   update 			   etop_service			   set service_status ='203'			   where 			   service_id=#{serviceId}  	  </update>	  <update id="overOfSend" parameterType="com.etop.website.bean.Parkservice">				UPDATE etop_service t1				INNER JOIN etop_service_dispatch t2 ON t1.service_id = t2.service_id				SET t1.service_status = '204',				 t2.status = '102' ,				 t1.complete_time=#{complete_time},				 t2.complete_time=#{completeTime}				WHERE					t1.service_id = #{service_id}  	  </update>	  <update id="statusOfOver" parameterType="com.etop.website.bean.Parkservice">			   update 			   etop_service			   set service_status ='300'			   where 			   service_id=#{serviceId}  	  </update>	              <!-- 派工 -->	        <insert id="addDispatch"  parameterType="com.etop.management.bean.ServiceDispatch"  >		  INSERT INTO 		    etop_service_dispatch (		         dispatch_id,service_id,status,name,phone,email,		         despatch_time,complete_time,dispatcher,description		       )			VALUES( 				 #{dispatchId},#{serviceId},#{status},#{name},#{phone},				 #{email},#{despatchTime},null,#{dispatcher},#{description}				 			   )      </insert>	  </mapper>